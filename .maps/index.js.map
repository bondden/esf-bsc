{"version":3,"sources":["index.es7.js"],"names":[],"mappings":"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","file":"index.es7.js","sourcesContent":["/**\n * Created by Denis Bondarenko <bond.den@gmail.com> on 01.08.2015.\n */\n\"use strict\";\n\nvar\n  fs       =require('fs-extra'),\n  path     =require('path'),\n  parentSrc=require('parent-search')\n  ;\n\nimport * as modUtl from 'esf-utl';\n\nvar\n  U=modUtl.Utl,\n  L=U.log,\n  E=U.rejectingError\n  ;\n\n/**\n * abstract class\n */\nexport class Bsc {\n\n  constructor(){\n    this.cfg   =null;\n    this.cfgPth='tst/d/esfapp.cfg.json';\n  }\n\n  /**\n   * [[Description]]\n   * @returns {Promise} [[Description]]\n   */\n  loadConfig(cfgObj=null){\n\n    var H=this;\n    if(H.cfg){\n      return new Promise((rs,rj)=>{\n        L('Bsc: Using preset cfg: '+JSON.stringify(H.cfg,null,'\\t'));\n        rs(H.cfg);\n      });\n    }\n\n    return new Promise((rs,rj)=>{\n      \n      if(cfgObj){\n        \n        // in-memory cfgObj is set\n        \n        try{\n          \n          let cfgObjCln=JSON.parse(U.stringifyJSON(cfgObj));\n          \n          if(cfgObjCln){            \n            H.cfg=cfgObjCln;\n            \n            //L(`H.cfg:  ${U.stringifyJSON(H.cfg)}`,'yb');\n            //L(`cfgObj: ${U.stringifyJSON(cfgObj)}`,'yb');\n            \n            rs(H.cfg);\n          }else{            \n            let msg='in-memory cfgObject error: not an object';\n            return E(12,msg,new Error(msg),rj);\n          }\n          \n        }catch(e){\n          return E(11,'in-memory cfgObject error',e,rj);\n        }\n        \n      }else{\n        \n        // look for settings in fs\n\n        L('Searching .esfrc starting from : `'+__dirname+'`...');\n\n        parentSrc(__dirname,'.esfrc',{},(e0,esfrcPth)=>{\n\n          if(e0){\n            return E(3,'.esfrc search error',e0,rj);\n          }\n\n          if(!esfrcPth){\n            let msg='.esfrc not found';\n            return E(4,msg,new Error(msg),rj);\n          }\n\n          L('.esfrc found at : '+esfrcPth);\n\n          let esfrcPath=path.resolve(esfrcPth);\n          L('Getting cfgPth from : `'+esfrcPath+'`...');\n          fs.readJson(esfrcPath,(e,r)=>{\n\n            if(e){\n              return E(1,'.esfrc reading error',e,rj);\n            }\n\n            if(typeof r.cfgPth==='string'){\n              H.cfgPth=r.cfgPth;\n            }\n\n            if(!path.isAbsolute(H.cfgPth)){\n              H.cfgPth=path.resolve(path.dirname(esfrcPth)+'/'+H.cfgPth);\n            }\n\n            L('Using cfgPath: '+H.cfgPth);\n\n            fs.readJson(path.resolve(H.cfgPth),(e1,cfg)=>{\n\n              if(e1){\n                return E(2,'Error reading '+H.cfgPth,e1,rj);\n              }\n\n              H.cfg=cfg;\n              rs(H.cfg);\n\n            });\n\n          });\n\n        });\n        \n      }\n\n    });\n\n  }\n\n  reloadConfig(cfg=null){\n    var H=this;\n    return new Promise((rs,rj)=>{\n\n      let cfgObj=null;\n      if(cfg){\n        if(typeof cfg === 'string'){\n          // this can be a path to cfg file:\n          H.cfgPth=cfg; \n        }else if(typeof cfg === 'object' && cfg){\n          cfgObj=cfg;\n        }else{\n          let msg=`Incorrect config: ${U.stringifyJSON(cfg)}`;\n          return E(12,msg,new Error(msg),rj);\n        }\n      }\n\n      H.loadConfig(cfgObj)\n       .then(r=>{\n         rs(r);\n       })\n       .catch(e=>{\n         return E(11,'Error reloading config from: '+H.cfgPth,e,rj);\n       })\n      ;\n\n    });\n  }\n\n}\n"],"sourceRoot":"/source/"}